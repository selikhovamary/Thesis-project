!function(e,t){if("function"==typeof define&&define.amd)define(["module","exports"],t);else if("undefined"!=typeof exports)t(module,exports);else{var n={exports:{}};t(n,n.exports),e.WOW=n.exports}}(this,function(e,t){"use strict";var n,i;function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e};function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t){return 0<=t.indexOf(e)}function l(e,t,n){null!=e.addEventListener?e.addEventListener(t,n,!1):null!=e.attachEvent?e.attachEvent("on"+t,n):e[t]=n}function c(e,t,n){null!=e.removeEventListener?e.removeEventListener(t,n,!1):null!=e.detachEvent?e.detachEvent("on"+t,n):delete e[t]}var u=window.WeakMap||window.MozWeakMap||(s(h,[{key:"get",value:function(e){for(var t=0;t<this.keys.length;t++)if(this.keys[t]===e)return this.values[t]}},{key:"set",value:function(e,t){for(var n=0;n<this.keys.length;n++)if(this.keys[n]===e)return this.values[n]=t,this;return this.keys.push(e),this.values.push(t),this}}]),h);function h(){o(this,h),this.keys=[],this.values=[]}var d=window.MutationObserver||window.WebkitMutationObserver||window.MozMutationObserver||(s(f,[{key:"observe",value:function(){}}]),i=n=f,n.notSupported=!0,i);function f(){o(this,f),"undefined"!=typeof console&&null!==console&&(console.warn("MutationObserver is not supported by your browser."),console.warn("WOW.js cannot detect dom mutations, please call .sync() after loading new content."))}var v=window.getComputedStyle||function(n){var i=/(\-([a-z]){1})/g;return{getPropertyValue:function(e){"float"===e&&(e="styleFloat"),i.test(e)&&e.replace(i,function(e,t){return t.toUpperCase()});var t=n.currentStyle;return(null!=t?t[e]:void 0)||null}}},m=(s(y,[{key:"init",value:function(){this.element=window.document.documentElement,r(document.readyState,["interactive","complete"])?this.start():l(document,"DOMContentLoaded",this.start),this.finished=[]}},{key:"start",value:function(){var s=this;if(this.stopped=!1,this.boxes=[].slice.call(this.element.querySelectorAll("."+this.config.boxClass)),this.all=this.boxes.slice(0),this.boxes.length)if(this.disabled())this.resetStyle();else for(var e=0;e<this.boxes.length;e++){var t=this.boxes[e];this.applyStyle(t,!0)}this.disabled()||(l(this.config.scrollContainer||window,"scroll",this.scrollHandler),l(window,"resize",this.scrollHandler),this.interval=setInterval(this.scrollCallback,50)),this.config.live&&new d(function(e){for(var t=0;t<e.length;t++)for(var n=e[t],i=0;i<n.addedNodes.length;i++){var o=n.addedNodes[i];s.doSync(o)}}).observe(document.body,{childList:!0,subtree:!0})}},{key:"stop",value:function(){this.stopped=!0,c(this.config.scrollContainer||window,"scroll",this.scrollHandler),c(window,"resize",this.scrollHandler),null!=this.interval&&clearInterval(this.interval)}},{key:"sync",value:function(){d.notSupported&&this.doSync(this.element)}},{key:"doSync",value:function(e){if(null==e&&(e=this.element),1===e.nodeType)for(var t=(e=e.parentNode||e).querySelectorAll("."+this.config.boxClass),n=0;n<t.length;n++){var i=t[n];r(i,this.all)||(this.boxes.push(i),this.all.push(i),this.stopped||this.disabled()?this.resetStyle():this.applyStyle(i,!0),this.scrolled=!0)}}},{key:"show",value:function(e){return this.applyStyle(e),e.className=e.className+" "+this.config.animateClass,null!=this.config.callback&&this.config.callback(e),function(e,t){null!=e.dispatchEvent?e.dispatchEvent(t):t in(null!=e)?e[t]():"on"+t in(null!=e)&&e["on"+t]()}(e,this.wowEvent),this.config.resetAnimation&&(l(e,"animationend",this.resetAnimation),l(e,"oanimationend",this.resetAnimation),l(e,"webkitAnimationEnd",this.resetAnimation),l(e,"MSAnimationEnd",this.resetAnimation)),e}},{key:"applyStyle",value:function(e,t){var n=this,i=e.getAttribute("data-wow-duration"),o=e.getAttribute("data-wow-delay"),s=e.getAttribute("data-wow-iteration");return this.animate(function(){return n.customStyle(e,t,i,o,s)})}},{key:"resetStyle",value:function(){for(var e=0;e<this.boxes.length;e++)this.boxes[e].style.visibility="visible"}},{key:"resetAnimation",value:function(e){if(0<=e.type.toLowerCase().indexOf("animationend")){var t=e.target||e.srcElement;t.className=t.className.replace(this.config.animateClass,"").trim()}}},{key:"customStyle",value:function(e,t,n,i,o){return t&&this.cacheAnimationName(e),e.style.visibility=t?"hidden":"visible",n&&this.vendorSet(e.style,{animationDuration:n}),i&&this.vendorSet(e.style,{animationDelay:i}),o&&this.vendorSet(e.style,{animationIterationCount:o}),this.vendorSet(e.style,{animationName:t?"none":this.cachedAnimationName(e)}),e}},{key:"vendorSet",value:function(e,t){for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];e[""+n]=i;for(var o=0;o<this.vendors.length;o++)e[""+this.vendors[o]+n.charAt(0).toUpperCase()+n.substr(1)]=i}}},{key:"vendorCSS",value:function(e,t){for(var n=v(e),i=n.getPropertyCSSValue(t),o=0;o<this.vendors.length;o++){var s=this.vendors[o];i=i||n.getPropertyCSSValue("-"+s+"-"+t)}return i}},{key:"animationName",value:function(t){var n=void 0;try{n=this.vendorCSS(t,"animation-name").cssText}catch(e){n=v(t).getPropertyValue("animation-name")}return"none"===n?"":n}},{key:"cacheAnimationName",value:function(e){return this.animationNameCache.set(e,this.animationName(e))}},{key:"cachedAnimationName",value:function(e){return this.animationNameCache.get(e)}},{key:"scrollHandler",value:function(){this.scrolled=!0}},{key:"scrollCallback",value:function(){if(this.scrolled){this.scrolled=!1;for(var e=[],t=0;t<this.boxes.length;t++){var n=this.boxes[t];if(n){if(this.isVisible(n)){this.show(n);continue}e.push(n)}}this.boxes=e,this.boxes.length||this.config.live||this.stop()}}},{key:"offsetTop",value:function(e){for(;void 0===e.offsetTop;)e=e.parentNode;for(var t=e.offsetTop;e.offsetParent;)t+=(e=e.offsetParent).offsetTop;return t}},{key:"isVisible",value:function(e){var t=e.getAttribute("data-wow-offset")||this.config.offset,n=this.config.scrollContainer&&this.config.scrollContainer.scrollTop||window.pageYOffset,i=n+Math.min(this.element.clientHeight,"innerHeight"in window?window.innerHeight:document.documentElement.clientHeight)-t,o=this.offsetTop(e),s=o+e.clientHeight;return o<=i&&n<=s}},{key:"disabled",value:function(){return!this.config.mobile&&function(e){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)}(navigator.userAgent)}}]),y);function y(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];o(this,y),this.defaults={boxClass:"wow",animateClass:"animated",offset:0,mobile:!0,live:!0,callback:null,scrollContainer:null,resetAnimation:!0},this.animate="requestAnimationFrame"in window?function(e){return window.requestAnimationFrame(e)}:function(e){return e()},this.vendors=["moz","webkit"],this.start=this.start.bind(this),this.resetAnimation=this.resetAnimation.bind(this),this.scrollHandler=this.scrollHandler.bind(this),this.scrollCallback=this.scrollCallback.bind(this),this.scrolled=!0,this.config=function(e,t){for(var n in t)if(null==e[n]){var i=t[n];e[n]=i}return e}(e,this.defaults),null!=e.scrollContainer&&(this.config.scrollContainer=document.querySelector(e.scrollContainer)),this.animationNameCache=new u,this.wowEvent=function(e,t,n,i){var o=!(arguments.length<=1||void 0===t)&&t,s=!(arguments.length<=2||void 0===n)&&n,a=arguments.length<=3||void 0===i?null:i,r=void 0;return null!=document.createEvent?(r=document.createEvent("CustomEvent")).initCustomEvent(e,o,s,a):null!=document.createEventObject?(r=document.createEventObject()).eventType=e:r.eventName=e,r}(this.config.boxClass)}t.default=m,e.exports=t.default});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZlbmRvci5qcyJdLCJuYW1lcyI6WyJnbG9iYWwiLCJmYWN0b3J5IiwiZGVmaW5lIiwiYW1kIiwiZXhwb3J0cyIsIm1vZHVsZSIsIm1vZCIsIldPVyIsInRoaXMiLCJfY2xhc3MiLCJfdGVtcCIsIl9jbGFzc0NhbGxDaGVjayIsImluc3RhbmNlIiwiQ29uc3RydWN0b3IiLCJUeXBlRXJyb3IiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsInZhbHVlIiwiX2NyZWF0ZUNsYXNzIiwicHJvdG9Qcm9wcyIsInN0YXRpY1Byb3BzIiwiZGVmaW5lUHJvcGVydGllcyIsInByb3RvdHlwZSIsInRhcmdldCIsInByb3BzIiwiaSIsImxlbmd0aCIsImRlc2NyaXB0b3IiLCJlbnVtZXJhYmxlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJrZXkiLCJpc0luIiwibmVlZGxlIiwiaGF5c3RhY2siLCJpbmRleE9mIiwiYWRkRXZlbnQiLCJlbGVtIiwiZXZlbnQiLCJmbiIsImFkZEV2ZW50TGlzdGVuZXIiLCJhdHRhY2hFdmVudCIsInJlbW92ZUV2ZW50IiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImRldGFjaEV2ZW50IiwiV2Vha01hcCIsIndpbmRvdyIsIk1veldlYWtNYXAiLCJrZXlzIiwidmFsdWVzIiwicHVzaCIsIk11dGF0aW9uT2JzZXJ2ZXIiLCJXZWJraXRNdXRhdGlvbk9ic2VydmVyIiwiTW96TXV0YXRpb25PYnNlcnZlciIsIm5vdFN1cHBvcnRlZCIsImNvbnNvbGUiLCJ3YXJuIiwiZ2V0Q29tcHV0ZWRTdHlsZSIsImVsIiwiZ2V0Q29tcHV0ZWRTdHlsZVJYIiwiZ2V0UHJvcGVydHlWYWx1ZSIsInByb3AiLCJ0ZXN0IiwicmVwbGFjZSIsIl8iLCJfY2hhciIsInRvVXBwZXJDYXNlIiwiY3VycmVudFN0eWxlIiwiZWxlbWVudCIsImRvY3VtZW50IiwiZG9jdW1lbnRFbGVtZW50IiwicmVhZHlTdGF0ZSIsInN0YXJ0IiwiZmluaXNoZWQiLCJfdGhpcyIsInN0b3BwZWQiLCJib3hlcyIsInNsaWNlIiwiY2FsbCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJjb25maWciLCJib3hDbGFzcyIsImFsbCIsImRpc2FibGVkIiwicmVzZXRTdHlsZSIsImJveCIsImFwcGx5U3R5bGUiLCJzY3JvbGxDb250YWluZXIiLCJzY3JvbGxIYW5kbGVyIiwiaW50ZXJ2YWwiLCJzZXRJbnRlcnZhbCIsInNjcm9sbENhbGxiYWNrIiwibGl2ZSIsInJlY29yZHMiLCJqIiwicmVjb3JkIiwiayIsImFkZGVkTm9kZXMiLCJub2RlIiwiZG9TeW5jIiwib2JzZXJ2ZSIsImJvZHkiLCJjaGlsZExpc3QiLCJzdWJ0cmVlIiwiY2xlYXJJbnRlcnZhbCIsIm5vZGVUeXBlIiwiaXRlcmFibGUiLCJwYXJlbnROb2RlIiwic2Nyb2xsZWQiLCJjbGFzc05hbWUiLCJhbmltYXRlQ2xhc3MiLCJjYWxsYmFjayIsImRpc3BhdGNoRXZlbnQiLCJlbWl0RXZlbnQiLCJ3b3dFdmVudCIsInJlc2V0QW5pbWF0aW9uIiwiaGlkZGVuIiwiX3RoaXMyIiwiZHVyYXRpb24iLCJnZXRBdHRyaWJ1dGUiLCJkZWxheSIsIml0ZXJhdGlvbiIsImFuaW1hdGUiLCJjdXN0b21TdHlsZSIsInN0eWxlIiwidmlzaWJpbGl0eSIsInR5cGUiLCJ0b0xvd2VyQ2FzZSIsInNyY0VsZW1lbnQiLCJ0cmltIiwiY2FjaGVBbmltYXRpb25OYW1lIiwidmVuZG9yU2V0IiwiYW5pbWF0aW9uRHVyYXRpb24iLCJhbmltYXRpb25EZWxheSIsImFuaW1hdGlvbkl0ZXJhdGlvbkNvdW50IiwiYW5pbWF0aW9uTmFtZSIsImNhY2hlZEFuaW1hdGlvbk5hbWUiLCJwcm9wZXJ0aWVzIiwibmFtZSIsImhhc093blByb3BlcnR5IiwidmVuZG9ycyIsImNoYXJBdCIsInN1YnN0ciIsInByb3BlcnR5IiwicmVzdWx0IiwiZ2V0UHJvcGVydHlDU1NWYWx1ZSIsInZlbmRvciIsImFOYW1lIiwidmVuZG9yQ1NTIiwiY3NzVGV4dCIsImVycm9yIiwiYW5pbWF0aW9uTmFtZUNhY2hlIiwic2V0IiwiZ2V0IiwicmVzdWx0cyIsImlzVmlzaWJsZSIsInNob3ciLCJzdG9wIiwidW5kZWZpbmVkIiwib2Zmc2V0VG9wIiwidG9wIiwib2Zmc2V0UGFyZW50Iiwib2Zmc2V0Iiwidmlld1RvcCIsInNjcm9sbFRvcCIsInBhZ2VZT2Zmc2V0Iiwidmlld0JvdHRvbSIsIk1hdGgiLCJtaW4iLCJjbGllbnRIZWlnaHQiLCJpbm5lckhlaWdodCIsImJvdHRvbSIsIm1vYmlsZSIsImFnZW50IiwiaXNNb2JpbGUiLCJuYXZpZ2F0b3IiLCJ1c2VyQWdlbnQiLCJvcHRpb25zIiwiYXJndW1lbnRzIiwiZGVmYXVsdHMiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJiaW5kIiwiY3VzdG9tIiwiZXh0ZW5kIiwicXVlcnlTZWxlY3RvciIsImJ1YmJsZSIsImNhbmNlbCIsImRldGFpbCIsImN1c3RvbUV2ZW50IiwiY3JlYXRlRXZlbnQiLCJpbml0Q3VzdG9tRXZlbnQiLCJjcmVhdGVFdmVudE9iamVjdCIsImV2ZW50VHlwZSIsImV2ZW50TmFtZSIsImRlZmF1bHQiXSwibWFwcGluZ3MiOiJDQUFBLFNBQVdBLEVBQVFDLEdBQ2pCLEdBQXNCLG1CQUFYQyxRQUF5QkEsT0FBT0MsSUFDekNELE9BQU8sQ0FBQyxTQUFVLFdBQVlELFFBQ3pCLEdBQXVCLG9CQUFaRyxRQUNoQkgsRUFBUUksT0FBUUQsYUFDWCxDQUNMLElBQUlFLEVBQU0sQ0FDUkYsUUFBUyxJQUVYSCxFQUFRSyxFQUFLQSxFQUFJRixTQUNqQkosRUFBT08sSUFBTUQsRUFBSUYsU0FWckIsQ0FZR0ksS0FBTSxTQUFVSCxFQUFRRCxHQUN6QixhQU1BLElBQUlLLEVBQVFDLEVBRVosU0FBU0MsRUFBZ0JDLEVBQVVDLEdBQ2pDLEtBQU1ELGFBQW9CQyxHQUN4QixNQUFNLElBQUlDLFVBQVUscUNBUnhCQyxPQUFPQyxlQUFlWixFQUFTLGFBQWMsQ0FDM0NhLE9BQU8sSUFXVCxJQUFJQyxFQVdLLFNBQVVMLEVBQWFNLEVBQVlDLEdBR3hDLE9B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QUN0QixJQUFLLElBQUlwSixLQUFPb0osRUFDZCxHQUFtQixNQUFmRyxFQUFPdkosR0FBYyxDQUN2QixJQUFJZCxFQUFRa0ssRUFBU3BKLEdBQ3JCdUosRUFBT3ZKLEdBQU9kLEVBR2xCLE9BQU9xSyxFQTJMU0MsQ0FBT04sRUFBU3pLLEtBQUsySyxVQUNKLE1BQTNCRixFQUFRMUYsa0JBQ1YvRSxLQUFLd0UsT0FBT08sZ0JBQWtCbEIsU0FBU21ILGNBQWNQLEVBQVExRixrQkFHL0QvRSxLQUFLK0ksbUJBQXFCLElBQUkxRyxFQUM5QnJDLEtBQUswRyxTQXpMVCxTQUFxQjVFLEVBQXJCLEVBQUEsRUFBQSxHQUNFLElBQUltSixJQUFTUCxVQUFVeEosUUFBVSxRQUFzQm9JLElBRHpELElBQUEsRUFFTTRCLElBQVNSLFVBQVV4SixRQUFVLFFBQXNCb0ksSUFGekQsSUFBQSxFQUdNNkIsRUFBU1QsVUFBVXhKLFFBQVUsUUFBc0JvSSxJQUh6RCxFQUdxRSxLQUhyRSxFQUtNOEIsT0FBYyxFQWFsQixPQVo0QixNQUF4QnZILFNBQVN3SCxhQUVYRCxFQUFjdkgsU0FBU3dILFlBQVksZ0JBQ3ZCQyxnQkFBZ0J4SixFQUFPbUosRUFBUUMsRUFBUUMsR0FDWixNQUE5QnRILFNBQVMwSCxtQkFFbEJILEVBQWN2SCxTQUFTMEgscUJBQ1hDLFVBQVkxSixFQUV4QnNKLEVBQVlLLFVBQVkzSixFQUduQnNKLEVBdUtXQyxDQUFZckwsS0FBS3dFLE9BQU9DLFVBNFI1QzdFLEVBQVE4TCxRQUFVM0wsRUFDbEJGLEVBQU9ELFFBQVVBLEVBQWlCIiwiZmlsZSI6InZlbmRvci5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoZ2xvYmFsLCBmYWN0b3J5KSB7XHJcbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09IFwiZnVuY3Rpb25cIiAmJiBkZWZpbmUuYW1kKSB7XHJcbiAgICBkZWZpbmUoWydtb2R1bGUnLCAnZXhwb3J0cyddLCBmYWN0b3J5KTtcclxuICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzICE9PSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICBmYWN0b3J5KG1vZHVsZSwgZXhwb3J0cyk7XHJcbiAgfSBlbHNlIHtcclxuICAgIHZhciBtb2QgPSB7XHJcbiAgICAgIGV4cG9ydHM6IHt9XHJcbiAgICB9O1xyXG4gICAgZmFjdG9yeShtb2QsIG1vZC5leHBvcnRzKTtcclxuICAgIGdsb2JhbC5XT1cgPSBtb2QuZXhwb3J0cztcclxuICB9XHJcbn0pKHRoaXMsIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHtcclxuICAndXNlIHN0cmljdCc7XHJcblxyXG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xyXG4gICAgdmFsdWU6IHRydWVcclxuICB9KTtcclxuXHJcbiAgdmFyIF9jbGFzcywgX3RlbXA7XHJcblxyXG4gIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHtcclxuICAgIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7XHJcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICB2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7XHJcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldO1xyXG4gICAgICAgIGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTtcclxuICAgICAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7XHJcbiAgICAgICAgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTtcclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykge1xyXG4gICAgICBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpO1xyXG4gICAgICBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTtcclxuICAgICAgcmV0dXJuIENvbnN0cnVjdG9yO1xyXG4gICAgfTtcclxuICB9KCk7XHJcblxyXG4gIGZ1bmN0aW9uIGlzSW4obmVlZGxlLCBoYXlzdGFjaykge1xyXG4gICAgcmV0dXJuIGhheXN0YWNrLmluZGV4T2YobmVlZGxlKSA+PSAwO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZXh0ZW5kKGN1c3RvbSwgZGVmYXVsdHMpIHtcclxuICAgIGZvciAodmFyIGtleSBpbiBkZWZhdWx0cykge1xyXG4gICAgICBpZiAoY3VzdG9tW2tleV0gPT0gbnVsbCkge1xyXG4gICAgICAgIHZhciB2YWx1ZSA9IGRlZmF1bHRzW2tleV07XHJcbiAgICAgICAgY3VzdG9tW2tleV0gPSB2YWx1ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGN1c3RvbTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGlzTW9iaWxlKGFnZW50KSB7XHJcbiAgICByZXR1cm4gKC9BbmRyb2lkfHdlYk9TfGlQaG9uZXxpUGFkfGlQb2R8QmxhY2tCZXJyeXxJRU1vYmlsZXxPcGVyYSBNaW5pL2kudGVzdChhZ2VudClcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBjcmVhdGVFdmVudChldmVudCkge1xyXG4gICAgdmFyIGJ1YmJsZSA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMSB8fCBhcmd1bWVudHNbMV0gPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogYXJndW1lbnRzWzFdO1xyXG4gICAgdmFyIGNhbmNlbCA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMiB8fCBhcmd1bWVudHNbMl0gPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogYXJndW1lbnRzWzJdO1xyXG4gICAgdmFyIGRldGFpbCA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMyB8fCBhcmd1bWVudHNbM10gPT09IHVuZGVmaW5lZCA/IG51bGwgOiBhcmd1bWVudHNbM107XHJcblxyXG4gICAgdmFyIGN1c3RvbUV2ZW50ID0gdm9pZCAwO1xyXG4gICAgaWYgKGRvY3VtZW50LmNyZWF0ZUV2ZW50ICE9IG51bGwpIHtcclxuICAgICAgLy8gVzNDIERPTVxyXG4gICAgICBjdXN0b21FdmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdDdXN0b21FdmVudCcpO1xyXG4gICAgICBjdXN0b21FdmVudC5pbml0Q3VzdG9tRXZlbnQoZXZlbnQsIGJ1YmJsZSwgY2FuY2VsLCBkZXRhaWwpO1xyXG4gICAgfSBlbHNlIGlmIChkb2N1bWVudC5jcmVhdGVFdmVudE9iamVjdCAhPSBudWxsKSB7XHJcbiAgICAgIC8vIElFIERPTSA8IDlcclxuICAgICAgY3VzdG9tRXZlbnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudE9iamVjdCgpO1xyXG4gICAgICBjdXN0b21FdmVudC5ldmVudFR5cGUgPSBldmVudDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGN1c3RvbUV2ZW50LmV2ZW50TmFtZSA9IGV2ZW50O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBjdXN0b21FdmVudDtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGVtaXRFdmVudChlbGVtLCBldmVudCkge1xyXG4gICAgaWYgKGVsZW0uZGlzcGF0Y2hFdmVudCAhPSBudWxsKSB7XHJcbiAgICAgIC8vIFczQyBET01cclxuICAgICAgZWxlbS5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcclxuICAgIH0gZWxzZSBpZiAoZXZlbnQgaW4gKGVsZW0gIT0gbnVsbCkpIHtcclxuICAgICAgZWxlbVtldmVudF0oKTtcclxuICAgIH0gZWxzZSBpZiAoJ29uJyArIGV2ZW50IGluIChlbGVtICE9IG51bGwpKSB7XHJcbiAgICAgIGVsZW1bJ29uJyArIGV2ZW50XSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gYWRkRXZlbnQoZWxlbSwgZXZlbnQsIGZuKSB7XHJcbiAgICBpZiAoZWxlbS5hZGRFdmVudExpc3RlbmVyICE9IG51bGwpIHtcclxuICAgICAgLy8gVzNDIERPTVxyXG4gICAgICBlbGVtLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIGZuLCBmYWxzZSk7XHJcbiAgICB9IGVsc2UgaWYgKGVsZW0uYXR0YWNoRXZlbnQgIT0gbnVsbCkge1xyXG4gICAgICAvLyBJRSBET01cclxuICAgICAgZWxlbS5hdHRhY2hFdmVudCgnb24nICsgZXZlbnQsIGZuKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIGZhbGxiYWNrXHJcbiAgICAgIGVsZW1bZXZlbnRdID0gZm47XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiByZW1vdmVFdmVudChlbGVtLCBldmVudCwgZm4pIHtcclxuICAgIGlmIChlbGVtLnJlbW92ZUV2ZW50TGlzdGVuZXIgIT0gbnVsbCkge1xyXG4gICAgICAvLyBXM0MgRE9NXHJcbiAgICAgIGVsZW0ucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudCwgZm4sIGZhbHNlKTtcclxuICAgIH0gZWxzZSBpZiAoZWxlbS5kZXRhY2hFdmVudCAhPSBudWxsKSB7XHJcbiAgICAgIC8vIElFIERPTVxyXG4gICAgICBlbGVtLmRldGFjaEV2ZW50KCdvbicgKyBldmVudCwgZm4pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gZmFsbGJhY2tcclxuICAgICAgZGVsZXRlIGVsZW1bZXZlbnRdO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZ2V0SW5uZXJIZWlnaHQoKSB7XHJcbiAgICBpZiAoJ2lubmVySGVpZ2h0JyBpbiB3aW5kb3cpIHtcclxuICAgICAgcmV0dXJuIHdpbmRvdy5pbm5lckhlaWdodDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodDtcclxuICB9XHJcblxyXG4gIC8vIE1pbmltYWxpc3RpYyBXZWFrTWFwIHNoaW0sIGp1c3QgaW4gY2FzZS5cclxuICB2YXIgV2Vha01hcCA9IHdpbmRvdy5XZWFrTWFwIHx8IHdpbmRvdy5Nb3pXZWFrTWFwIHx8IGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFdlYWtNYXAoKSB7XHJcbiAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBXZWFrTWFwKTtcclxuXHJcbiAgICAgIHRoaXMua2V5cyA9IFtdO1xyXG4gICAgICB0aGlzLnZhbHVlcyA9IFtdO1xyXG4gICAgfVxyXG5cclxuICAgIF9jcmVhdGVDbGFzcyhXZWFrTWFwLCBbe1xyXG4gICAgICBrZXk6ICdnZXQnLFxyXG4gICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0KGtleSkge1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5rZXlzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICB2YXIgaXRlbSA9IHRoaXMua2V5c1tpXTtcclxuICAgICAgICAgIGlmIChpdGVtID09PSBrZXkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudmFsdWVzW2ldO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICB9XHJcbiAgICB9LCB7XHJcbiAgICAgIGtleTogJ3NldCcsXHJcbiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXQoa2V5LCB2YWx1ZSkge1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5rZXlzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICB2YXIgaXRlbSA9IHRoaXMua2V5c1tpXTtcclxuICAgICAgICAgIGlmIChpdGVtID09PSBrZXkpIHtcclxuICAgICAgICAgICAgdGhpcy52YWx1ZXNbaV0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMua2V5cy5wdXNoKGtleSk7XHJcbiAgICAgICAgdGhpcy52YWx1ZXMucHVzaCh2YWx1ZSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgIH1cclxuICAgIH1dKTtcclxuXHJcbiAgICByZXR1cm4gV2Vha01hcDtcclxuICB9KCk7XHJcblxyXG4gIC8vIER1bW15IE11dGF0aW9uT2JzZXJ2ZXIsIHRvIGF2b2lkIHJhaXNpbmcgZXhjZXB0aW9ucy5cclxuICB2YXIgTXV0YXRpb25PYnNlcnZlciA9IHdpbmRvdy5NdXRhdGlvbk9ic2VydmVyIHx8IHdpbmRvdy5XZWJraXRNdXRhdGlvbk9ic2VydmVyIHx8IHdpbmRvdy5Nb3pNdXRhdGlvbk9ic2VydmVyIHx8IChfdGVtcCA9IF9jbGFzcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIE11dGF0aW9uT2JzZXJ2ZXIoKSB7XHJcbiAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBNdXRhdGlvbk9ic2VydmVyKTtcclxuXHJcbiAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29uc29sZSAhPT0gbnVsbCkge1xyXG4gICAgICAgIGNvbnNvbGUud2FybignTXV0YXRpb25PYnNlcnZlciBpcyBub3Qgc3VwcG9ydGVkIGJ5IHlvdXIgYnJvd3Nlci4nKTtcclxuICAgICAgICBjb25zb2xlLndhcm4oJ1dPVy5qcyBjYW5ub3QgZGV0ZWN0IGRvbSBtdXRhdGlvbnMsIHBsZWFzZSBjYWxsIC5zeW5jKCkgYWZ0ZXIgbG9hZGluZyBuZXcgY29udGVudC4nKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIF9jcmVhdGVDbGFzcyhNdXRhdGlvbk9ic2VydmVyLCBbe1xyXG4gICAgICBrZXk6ICdvYnNlcnZlJyxcclxuICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9ic2VydmUoKSB7fVxyXG4gICAgfV0pO1xyXG5cclxuICAgIHJldHVybiBNdXRhdGlvbk9ic2VydmVyO1xyXG4gIH0oKSwgX2NsYXNzLm5vdFN1cHBvcnRlZCA9IHRydWUsIF90ZW1wKTtcclxuXHJcbiAgLy8gZ2V0Q29tcHV0ZWRTdHlsZSBzaGltLCBmcm9tIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzIxNzk3Mjk0XHJcbiAgdmFyIGdldENvbXB1dGVkU3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSB8fCBmdW5jdGlvbiBnZXRDb21wdXRlZFN0eWxlKGVsKSB7XHJcbiAgICB2YXIgZ2V0Q29tcHV0ZWRTdHlsZVJYID0gLyhcXC0oW2Etel0pezF9KS9nO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgZ2V0UHJvcGVydHlWYWx1ZTogZnVuY3Rpb24gZ2V0UHJvcGVydHlWYWx1ZShwcm9wKSB7XHJcbiAgICAgICAgaWYgKHByb3AgPT09ICdmbG9hdCcpIHtcclxuICAgICAgICAgIHByb3AgPSAnc3R5bGVGbG9hdCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChnZXRDb21wdXRlZFN0eWxlUlgudGVzdChwcm9wKSkge1xyXG4gICAgICAgICAgcHJvcC5yZXBsYWNlKGdldENvbXB1dGVkU3R5bGVSWCwgZnVuY3Rpb24gKF8sIF9jaGFyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBfY2hhci50b1VwcGVyQ2FzZSgpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBjdXJyZW50U3R5bGUgPSBlbC5jdXJyZW50U3R5bGU7XHJcblxyXG4gICAgICAgIHJldHVybiAoY3VycmVudFN0eWxlICE9IG51bGwgPyBjdXJyZW50U3R5bGVbcHJvcF0gOiB2b2lkIDApIHx8IG51bGw7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgfTtcclxuXHJcbiAgdmFyIFdPVyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFdPVygpIHtcclxuICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDAgfHwgYXJndW1lbnRzWzBdID09PSB1bmRlZmluZWQgPyB7fSA6IGFyZ3VtZW50c1swXTtcclxuXHJcbiAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBXT1cpO1xyXG5cclxuICAgICAgdGhpcy5kZWZhdWx0cyA9IHtcclxuICAgICAgICBib3hDbGFzczogJ3dvdycsXHJcbiAgICAgICAgYW5pbWF0ZUNsYXNzOiAnYW5pbWF0ZWQnLFxyXG4gICAgICAgIG9mZnNldDogMCxcclxuICAgICAgICBtb2JpbGU6IHRydWUsXHJcbiAgICAgICAgbGl2ZTogdHJ1ZSxcclxuICAgICAgICBjYWxsYmFjazogbnVsbCxcclxuICAgICAgICBzY3JvbGxDb250YWluZXI6IG51bGwsXHJcbiAgICAgICAgcmVzZXRBbmltYXRpb246IHRydWVcclxuICAgICAgfTtcclxuXHJcbiAgICAgIHRoaXMuYW5pbWF0ZSA9IGZ1bmN0aW9uIGFuaW1hdGVGYWN0b3J5KCkge1xyXG4gICAgICAgIGlmICgncmVxdWVzdEFuaW1hdGlvbkZyYW1lJyBpbiB3aW5kb3cpIHtcclxuICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoY2FsbGJhY2spO1xyXG4gICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgfSgpO1xyXG5cclxuICAgICAgdGhpcy52ZW5kb3JzID0gWydtb3onLCAnd2Via2l0J107XHJcblxyXG4gICAgICB0aGlzLnN0YXJ0ID0gdGhpcy5zdGFydC5iaW5kKHRoaXMpO1xyXG4gICAgICB0aGlzLnJlc2V0QW5pbWF0aW9uID0gdGhpcy5yZXNldEFuaW1hdGlvbi5iaW5kKHRoaXMpO1xyXG4gICAgICB0aGlzLnNjcm9sbEhhbmRsZXIgPSB0aGlzLnNjcm9sbEhhbmRsZXIuYmluZCh0aGlzKTtcclxuICAgICAgdGhpcy5zY3JvbGxDYWxsYmFjayA9IHRoaXMuc2Nyb2xsQ2FsbGJhY2suYmluZCh0aGlzKTtcclxuICAgICAgdGhpcy5zY3JvbGxlZCA9IHRydWU7XHJcbiAgICAgIHRoaXMuY29uZmlnID0gZXh0ZW5kKG9wdGlvbnMsIHRoaXMuZGVmYXVsdHMpO1xyXG4gICAgICBpZiAob3B0aW9ucy5zY3JvbGxDb250YWluZXIgIT0gbnVsbCkge1xyXG4gICAgICAgIHRoaXMuY29uZmlnLnNjcm9sbENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy5zY3JvbGxDb250YWluZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIE1hcCBvZiBlbGVtZW50cyB0byBhbmltYXRpb24gbmFtZXM6XHJcbiAgICAgIHRoaXMuYW5pbWF0aW9uTmFtZUNhY2hlID0gbmV3IFdlYWtNYXAoKTtcclxuICAgICAgdGhpcy53b3dFdmVudCA9IGNyZWF0ZUV2ZW50KHRoaXMuY29uZmlnLmJveENsYXNzKTtcclxuICAgIH1cclxuXHJcbiAgICBfY3JlYXRlQ2xhc3MoV09XLCBbe1xyXG4gICAgICBrZXk6ICdpbml0JyxcclxuICAgICAgdmFsdWU6IGZ1bmN0aW9uIGluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gd2luZG93LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcclxuICAgICAgICBpZiAoaXNJbihkb2N1bWVudC5yZWFkeVN0YXRlLCBbJ2ludGVyYWN0aXZlJywgJ2NvbXBsZXRlJ10pKSB7XHJcbiAgICAgICAgICB0aGlzLnN0YXJ0KCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGFkZEV2ZW50KGRvY3VtZW50LCAnRE9NQ29udGVudExvYWRlZCcsIHRoaXMuc3RhcnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmZpbmlzaGVkID0gW107XHJcbiAgICAgIH1cclxuICAgIH0sIHtcclxuICAgICAga2V5OiAnc3RhcnQnLFxyXG4gICAgICB2YWx1ZTogZnVuY3Rpb24gc3RhcnQoKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuXHJcbiAgICAgICAgdGhpcy5zdG9wcGVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5ib3hlcyA9IFtdLnNsaWNlLmNhbGwodGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgdGhpcy5jb25maWcuYm94Q2xhc3MpKTtcclxuICAgICAgICB0aGlzLmFsbCA9IHRoaXMuYm94ZXMuc2xpY2UoMCk7XHJcbiAgICAgICAgaWYgKHRoaXMuYm94ZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICBpZiAodGhpcy5kaXNhYmxlZCgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVzZXRTdHlsZSgpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmJveGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgdmFyIGJveCA9IHRoaXMuYm94ZXNbaV07XHJcbiAgICAgICAgICAgICAgdGhpcy5hcHBseVN0eWxlKGJveCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0aGlzLmRpc2FibGVkKCkpIHtcclxuICAgICAgICAgIGFkZEV2ZW50KHRoaXMuY29uZmlnLnNjcm9sbENvbnRhaW5lciB8fCB3aW5kb3csICdzY3JvbGwnLCB0aGlzLnNjcm9sbEhhbmRsZXIpO1xyXG4gICAgICAgICAgYWRkRXZlbnQod2luZG93LCAncmVzaXplJywgdGhpcy5zY3JvbGxIYW5kbGVyKTtcclxuICAgICAgICAgIHRoaXMuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCh0aGlzLnNjcm9sbENhbGxiYWNrLCA1MCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmNvbmZpZy5saXZlKSB7XHJcbiAgICAgICAgICB2YXIgbXV0ID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoZnVuY3Rpb24gKHJlY29yZHMpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCByZWNvcmRzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgdmFyIHJlY29yZCA9IHJlY29yZHNbal07XHJcbiAgICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCByZWNvcmQuYWRkZWROb2Rlcy5sZW5ndGg7IGsrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIG5vZGUgPSByZWNvcmQuYWRkZWROb2Rlc1trXTtcclxuICAgICAgICAgICAgICAgIF90aGlzLmRvU3luYyhub2RlKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgbXV0Lm9ic2VydmUoZG9jdW1lbnQuYm9keSwge1xyXG4gICAgICAgICAgICBjaGlsZExpc3Q6IHRydWUsXHJcbiAgICAgICAgICAgIHN1YnRyZWU6IHRydWVcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSwge1xyXG4gICAgICBrZXk6ICdzdG9wJyxcclxuICAgICAgdmFsdWU6IGZ1bmN0aW9uIHN0b3AoKSB7XHJcbiAgICAgICAgdGhpcy5zdG9wcGVkID0gdHJ1ZTtcclxuICAgICAgICByZW1vdmVFdmVudCh0aGlzLmNvbmZpZy5zY3JvbGxDb250YWluZXIgfHwgd2luZG93LCAnc2Nyb2xsJywgdGhpcy5zY3JvbGxIYW5kbGVyKTtcclxuICAgICAgICByZW1vdmVFdmVudCh3aW5kb3csICdyZXNpemUnLCB0aGlzLnNjcm9sbEhhbmRsZXIpO1xyXG4gICAgICAgIGlmICh0aGlzLmludGVydmFsICE9IG51bGwpIHtcclxuICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9LCB7XHJcbiAgICAgIGtleTogJ3N5bmMnLFxyXG4gICAgICB2YWx1ZTogZnVuY3Rpb24gc3luYygpIHtcclxuICAgICAgICBpZiAoTXV0YXRpb25PYnNlcnZlci5ub3RTdXBwb3J0ZWQpIHtcclxuICAgICAgICAgIHRoaXMuZG9TeW5jKHRoaXMuZWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9LCB7XHJcbiAgICAgIGtleTogJ2RvU3luYycsXHJcbiAgICAgIHZhbHVlOiBmdW5jdGlvbiBkb1N5bmMoZWxlbWVudCkge1xyXG4gICAgICAgIGlmICh0eXBlb2YgZWxlbWVudCA9PT0gJ3VuZGVmaW5lZCcgfHwgZWxlbWVudCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGVsZW1lbnQubm9kZVR5cGUgIT09IDEpIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZSB8fCBlbGVtZW50O1xyXG4gICAgICAgIHZhciBpdGVyYWJsZSA9IGVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLicgKyB0aGlzLmNvbmZpZy5ib3hDbGFzcyk7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpdGVyYWJsZS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgdmFyIGJveCA9IGl0ZXJhYmxlW2ldO1xyXG4gICAgICAgICAgaWYgKCFpc0luKGJveCwgdGhpcy5hbGwpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYm94ZXMucHVzaChib3gpO1xyXG4gICAgICAgICAgICB0aGlzLmFsbC5wdXNoKGJveCk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnN0b3BwZWQgfHwgdGhpcy5kaXNhYmxlZCgpKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5yZXNldFN0eWxlKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5hcHBseVN0eWxlKGJveCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5zY3JvbGxlZCA9IHRydWU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9LCB7XHJcbiAgICAgIGtleTogJ3Nob3cnLFxyXG4gICAgICB2YWx1ZTogZnVuY3Rpb24gc2hvdyhib3gpIHtcclxuICAgICAgICB0aGlzLmFwcGx5U3R5bGUoYm94KTtcclxuICAgICAgICBib3guY2xhc3NOYW1lID0gYm94LmNsYXNzTmFtZSArICcgJyArIHRoaXMuY29uZmlnLmFuaW1hdGVDbGFzcztcclxuICAgICAgICBpZiAodGhpcy5jb25maWcuY2FsbGJhY2sgIT0gbnVsbCkge1xyXG4gICAgICAgICAgdGhpcy5jb25maWcuY2FsbGJhY2soYm94KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZW1pdEV2ZW50KGJveCwgdGhpcy53b3dFdmVudCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmNvbmZpZy5yZXNldEFuaW1hdGlvbikge1xyXG4gICAgICAgICAgYWRkRXZlbnQoYm94LCAnYW5pbWF0aW9uZW5kJywgdGhpcy5yZXNldEFuaW1hdGlvbik7XHJcbiAgICAgICAgICBhZGRFdmVudChib3gsICdvYW5pbWF0aW9uZW5kJywgdGhpcy5yZXNldEFuaW1hdGlvbik7XHJcbiAgICAgICAgICBhZGRFdmVudChib3gsICd3ZWJraXRBbmltYXRpb25FbmQnLCB0aGlzLnJlc2V0QW5pbWF0aW9uKTtcclxuICAgICAgICAgIGFkZEV2ZW50KGJveCwgJ01TQW5pbWF0aW9uRW5kJywgdGhpcy5yZXNldEFuaW1hdGlvbik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gYm94O1xyXG4gICAgICB9XHJcbiAgICB9LCB7XHJcbiAgICAgIGtleTogJ2FwcGx5U3R5bGUnLFxyXG4gICAgICB2YWx1ZTogZnVuY3Rpb24gYXBwbHlTdHlsZShib3gsIGhpZGRlbikge1xyXG4gICAgICAgIHZhciBfdGhpczIgPSB0aGlzO1xyXG5cclxuICAgICAgICB2YXIgZHVyYXRpb24gPSBib3guZ2V0QXR0cmlidXRlKCdkYXRhLXdvdy1kdXJhdGlvbicpO1xyXG4gICAgICAgIHZhciBkZWxheSA9IGJveC5nZXRBdHRyaWJ1dGUoJ2RhdGEtd293LWRlbGF5Jyk7XHJcbiAgICAgICAgdmFyIGl0ZXJhdGlvbiA9IGJveC5nZXRBdHRyaWJ1dGUoJ2RhdGEtd293LWl0ZXJhdGlvbicpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5hbmltYXRlKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgIHJldHVybiBfdGhpczIuY3VzdG9tU3R5bGUoYm94LCBoaWRkZW4sIGR1cmF0aW9uLCBkZWxheSwgaXRlcmF0aW9uKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSwge1xyXG4gICAgICBrZXk6ICdyZXNldFN0eWxlJyxcclxuICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlc2V0U3R5bGUoKSB7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmJveGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICB2YXIgYm94ID0gdGhpcy5ib3hlc1tpXTtcclxuICAgICAgICAgIGJveC5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICB9XHJcbiAgICB9LCB7XHJcbiAgICAgIGtleTogJ3Jlc2V0QW5pbWF0aW9uJyxcclxuICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlc2V0QW5pbWF0aW9uKGV2ZW50KSB7XHJcbiAgICAgICAgaWYgKGV2ZW50LnR5cGUudG9Mb3dlckNhc2UoKS5pbmRleE9mKCdhbmltYXRpb25lbmQnKSA+PSAwKSB7XHJcbiAgICAgICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0IHx8IGV2ZW50LnNyY0VsZW1lbnQ7XHJcbiAgICAgICAgICB0YXJnZXQuY2xhc3NOYW1lID0gdGFyZ2V0LmNsYXNzTmFtZS5yZXBsYWNlKHRoaXMuY29uZmlnLmFuaW1hdGVDbGFzcywgJycpLnRyaW0oKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0sIHtcclxuICAgICAga2V5OiAnY3VzdG9tU3R5bGUnLFxyXG4gICAgICB2YWx1ZTogZnVuY3Rpb24gY3VzdG9tU3R5bGUoYm94LCBoaWRkZW4sIGR1cmF0aW9uLCBkZWxheSwgaXRlcmF0aW9uKSB7XHJcbiAgICAgICAgaWYgKGhpZGRlbikge1xyXG4gICAgICAgICAgdGhpcy5jYWNoZUFuaW1hdGlvbk5hbWUoYm94KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYm94LnN0eWxlLnZpc2liaWxpdHkgPSBoaWRkZW4gPyAnaGlkZGVuJyA6ICd2aXNpYmxlJztcclxuXHJcbiAgICAgICAgaWYgKGR1cmF0aW9uKSB7XHJcbiAgICAgICAgICB0aGlzLnZlbmRvclNldChib3guc3R5bGUsIHsgYW5pbWF0aW9uRHVyYXRpb246IGR1cmF0aW9uIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZGVsYXkpIHtcclxuICAgICAgICAgIHRoaXMudmVuZG9yU2V0KGJveC5zdHlsZSwgeyBhbmltYXRpb25EZWxheTogZGVsYXkgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpdGVyYXRpb24pIHtcclxuICAgICAgICAgIHRoaXMudmVuZG9yU2V0KGJveC5zdHlsZSwgeyBhbmltYXRpb25JdGVyYXRpb25Db3VudDogaXRlcmF0aW9uIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnZlbmRvclNldChib3guc3R5bGUsIHsgYW5pbWF0aW9uTmFtZTogaGlkZGVuID8gJ25vbmUnIDogdGhpcy5jYWNoZWRBbmltYXRpb25OYW1lKGJveCkgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBib3g7XHJcbiAgICAgIH1cclxuICAgIH0sIHtcclxuICAgICAga2V5OiAndmVuZG9yU2V0JyxcclxuICAgICAgdmFsdWU6IGZ1bmN0aW9uIHZlbmRvclNldChlbGVtLCBwcm9wZXJ0aWVzKSB7XHJcbiAgICAgICAgZm9yICh2YXIgbmFtZSBpbiBwcm9wZXJ0aWVzKSB7XHJcbiAgICAgICAgICBpZiAocHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSkge1xyXG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBwcm9wZXJ0aWVzW25hbWVdO1xyXG4gICAgICAgICAgICBlbGVtWycnICsgbmFtZV0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnZlbmRvcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICB2YXIgdmVuZG9yID0gdGhpcy52ZW5kb3JzW2ldO1xyXG4gICAgICAgICAgICAgIGVsZW1bJycgKyB2ZW5kb3IgKyBuYW1lLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgbmFtZS5zdWJzdHIoMSldID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0sIHtcclxuICAgICAga2V5OiAndmVuZG9yQ1NTJyxcclxuICAgICAgdmFsdWU6IGZ1bmN0aW9uIHZlbmRvckNTUyhlbGVtLCBwcm9wZXJ0eSkge1xyXG4gICAgICAgIHZhciBzdHlsZSA9IGdldENvbXB1dGVkU3R5bGUoZWxlbSk7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IHN0eWxlLmdldFByb3BlcnR5Q1NTVmFsdWUocHJvcGVydHkpO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy52ZW5kb3JzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICB2YXIgdmVuZG9yID0gdGhpcy52ZW5kb3JzW2ldO1xyXG4gICAgICAgICAgcmVzdWx0ID0gcmVzdWx0IHx8IHN0eWxlLmdldFByb3BlcnR5Q1NTVmFsdWUoJy0nICsgdmVuZG9yICsgJy0nICsgcHJvcGVydHkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICB9XHJcbiAgICB9LCB7XHJcbiAgICAgIGtleTogJ2FuaW1hdGlvbk5hbWUnLFxyXG4gICAgICB2YWx1ZTogZnVuY3Rpb24gYW5pbWF0aW9uTmFtZShib3gpIHtcclxuICAgICAgICB2YXIgYU5hbWUgPSB2b2lkIDA7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGFOYW1lID0gdGhpcy52ZW5kb3JDU1MoYm94LCAnYW5pbWF0aW9uLW5hbWUnKS5jc3NUZXh0O1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAvLyBPcGVyYSwgZmFsbCBiYWNrIHRvIHBsYWluIHByb3BlcnR5IHZhbHVlXHJcbiAgICAgICAgICBhTmFtZSA9IGdldENvbXB1dGVkU3R5bGUoYm94KS5nZXRQcm9wZXJ0eVZhbHVlKCdhbmltYXRpb24tbmFtZScpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGFOYW1lID09PSAnbm9uZScpIHtcclxuICAgICAgICAgIHJldHVybiAnJzsgLy8gU1ZHL0ZpcmVmb3gsIHVuYWJsZSB0byBnZXQgYW5pbWF0aW9uIG5hbWU/XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gYU5hbWU7XHJcbiAgICAgIH1cclxuICAgIH0sIHtcclxuICAgICAga2V5OiAnY2FjaGVBbmltYXRpb25OYW1lJyxcclxuICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNhY2hlQW5pbWF0aW9uTmFtZShib3gpIHtcclxuICAgICAgICAvLyBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD05MjE4MzRcclxuICAgICAgICAvLyBib3guZGF0YXNldCBpcyBub3Qgc3VwcG9ydGVkIGZvciBTVkcgZWxlbWVudHMgaW4gRmlyZWZveFxyXG4gICAgICAgIHJldHVybiB0aGlzLmFuaW1hdGlvbk5hbWVDYWNoZS5zZXQoYm94LCB0aGlzLmFuaW1hdGlvbk5hbWUoYm94KSk7XHJcbiAgICAgIH1cclxuICAgIH0sIHtcclxuICAgICAga2V5OiAnY2FjaGVkQW5pbWF0aW9uTmFtZScsXHJcbiAgICAgIHZhbHVlOiBmdW5jdGlvbiBjYWNoZWRBbmltYXRpb25OYW1lKGJveCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmFuaW1hdGlvbk5hbWVDYWNoZS5nZXQoYm94KTtcclxuICAgICAgfVxyXG4gICAgfSwge1xyXG4gICAgICBrZXk6ICdzY3JvbGxIYW5kbGVyJyxcclxuICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNjcm9sbEhhbmRsZXIoKSB7XHJcbiAgICAgICAgdGhpcy5zY3JvbGxlZCA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgIH0sIHtcclxuICAgICAga2V5OiAnc2Nyb2xsQ2FsbGJhY2snLFxyXG4gICAgICB2YWx1ZTogZnVuY3Rpb24gc2Nyb2xsQ2FsbGJhY2soKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuc2Nyb2xsZWQpIHtcclxuICAgICAgICAgIHRoaXMuc2Nyb2xsZWQgPSBmYWxzZTtcclxuICAgICAgICAgIHZhciByZXN1bHRzID0gW107XHJcbiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuYm94ZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIGJveCA9IHRoaXMuYm94ZXNbaV07XHJcbiAgICAgICAgICAgIGlmIChib3gpIHtcclxuICAgICAgICAgICAgICBpZiAodGhpcy5pc1Zpc2libGUoYm94KSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93KGJveCk7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKGJveCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRoaXMuYm94ZXMgPSByZXN1bHRzO1xyXG4gICAgICAgICAgaWYgKCF0aGlzLmJveGVzLmxlbmd0aCAmJiAhdGhpcy5jb25maWcubGl2ZSkge1xyXG4gICAgICAgICAgICB0aGlzLnN0b3AoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0sIHtcclxuICAgICAga2V5OiAnb2Zmc2V0VG9wJyxcclxuICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9mZnNldFRvcChlbGVtZW50KSB7XHJcbiAgICAgICAgLy8gU1ZHIGVsZW1lbnRzIGRvbid0IGhhdmUgYW4gb2Zmc2V0VG9wIGluIEZpcmVmb3guXHJcbiAgICAgICAgLy8gVGhpcyB3aWxsIHVzZSB0aGVpciBuZWFyZXN0IHBhcmVudCB0aGF0IGhhcyBhbiBvZmZzZXRUb3AuXHJcbiAgICAgICAgLy8gQWxzbywgdXNpbmcgKCdvZmZzZXRUb3AnIG9mIGVsZW1lbnQpIGNhdXNlcyBhbiBleGNlcHRpb24gaW4gRmlyZWZveC5cclxuICAgICAgICB3aGlsZSAoZWxlbWVudC5vZmZzZXRUb3AgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHRvcCA9IGVsZW1lbnQub2Zmc2V0VG9wO1xyXG4gICAgICAgIHdoaWxlIChlbGVtZW50Lm9mZnNldFBhcmVudCkge1xyXG4gICAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQub2Zmc2V0UGFyZW50O1xyXG4gICAgICAgICAgdG9wICs9IGVsZW1lbnQub2Zmc2V0VG9wO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdG9wO1xyXG4gICAgICB9XHJcbiAgICB9LCB7XHJcbiAgICAgIGtleTogJ2lzVmlzaWJsZScsXHJcbiAgICAgIHZhbHVlOiBmdW5jdGlvbiBpc1Zpc2libGUoYm94KSB7XHJcbiAgICAgICAgdmFyIG9mZnNldCA9IGJveC5nZXRBdHRyaWJ1dGUoJ2RhdGEtd293LW9mZnNldCcpIHx8IHRoaXMuY29uZmlnLm9mZnNldDtcclxuICAgICAgICB2YXIgdmlld1RvcCA9IHRoaXMuY29uZmlnLnNjcm9sbENvbnRhaW5lciAmJiB0aGlzLmNvbmZpZy5zY3JvbGxDb250YWluZXIuc2Nyb2xsVG9wIHx8IHdpbmRvdy5wYWdlWU9mZnNldDtcclxuICAgICAgICB2YXIgdmlld0JvdHRvbSA9IHZpZXdUb3AgKyBNYXRoLm1pbih0aGlzLmVsZW1lbnQuY2xpZW50SGVpZ2h0LCBnZXRJbm5lckhlaWdodCgpKSAtIG9mZnNldDtcclxuICAgICAgICB2YXIgdG9wID0gdGhpcy5vZmZzZXRUb3AoYm94KTtcclxuICAgICAgICB2YXIgYm90dG9tID0gdG9wICsgYm94LmNsaWVudEhlaWdodDtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRvcCA8PSB2aWV3Qm90dG9tICYmIGJvdHRvbSA+PSB2aWV3VG9wO1xyXG4gICAgICB9XHJcbiAgICB9LCB7XHJcbiAgICAgIGtleTogJ2Rpc2FibGVkJyxcclxuICAgICAgdmFsdWU6IGZ1bmN0aW9uIGRpc2FibGVkKCkge1xyXG4gICAgICAgIHJldHVybiAhdGhpcy5jb25maWcubW9iaWxlICYmIGlzTW9iaWxlKG5hdmlnYXRvci51c2VyQWdlbnQpO1xyXG4gICAgICB9XHJcbiAgICB9XSk7XHJcblxyXG4gICAgcmV0dXJuIFdPVztcclxuICB9KCk7XHJcblxyXG4gIGV4cG9ydHMuZGVmYXVsdCA9IFdPVztcclxuICBtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTtcclxufSk7Il19
